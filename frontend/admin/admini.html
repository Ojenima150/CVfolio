<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <link rel="stylesheet" href="../css/Admin_add_product.css" />
  <link rel="stylesheet" href="../css/admino.css">


  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8f8f8;
    }
    h2 { color: #333; margin-top: 25px; }
    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 25px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .item {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    input, textarea {
      width: 98%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .save {
      background: #28a745;
      color: #fff;
    }
    .delete {
      background: #dc3545;
      color: #fff;
      margin-left: 5px;
    }
  </style>

</head>
<body>

  <header class="navbar">
    <div class="logo">ğŸ›  Admin Dashboard<span class="accent">.</span></div>
    <nav>
      <ul class="nav-links">
        <li><a href="./admin.html">first Admin plane</a></li>
        <!-- <li><h2 class="topup">Admin Panel</h2></li> -->
      </ul>
    </nav>
    <button id="themeToggle">ğŸŒ™</button>
  </header> 

  <!-- <h1>ğŸ›  Admin Dashboard</h1> -->

   <!-- HERO IMAGE UPDATE -->
    <section>
      <h3>Hero Image Update</h3>
      <form id="heroForm" enctype="multipart/form-data">
        <input type="file" name="heroImage" accept="image/*" required />
        <button type="submit" class="save">Upload New Image</button>
      </form>
    </section>


  <div class="section">
    <h2>Skills</h2>
    <div id="skillsList">Loading...</div>
  </div>

  <div class="section">
    <h2>Experience</h2>
    <div id="expList">Loading...</div>
  </div>

  <div class="section">
    <h2>Projects</h2>
    <div id="projList">Loading...</div>
  </div>

  <div class="section">
    <h2>Certificates</h2>
    <div id="certList">Loading...</div>
  </div>

  <!-- =================== RATINGS =================== -->
   <!-- RATING SECTION -->
    <section>
        <h3>Client Ratings</h3>
       <div id="ratingList">Loading ratings...</div>
  </section>

  
<section class="sections">
  <h2 class="section-titlei">Contact Messages</h2>

  <table id="contactTable" class="admin-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Message</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="contactTableBody">
      <tr><td colspan="6">Loading...</td></tr>
    </tbody>
  </table>
</section>




  <h2>Manage Core Skills</h2>
  <!-- <div id="skillsList">Loading...</div> -->

  <div class="add-section">
    <h3>Add New Category</h3>
    <input id="newName" placeholder="Category (e.g. Languages & Frameworks)" />
    <input id="newLevel" placeholder="Items (e.g. Python, SQL, Flask...)" />
    <button id="addSkillBtn">Add Skill</button>
  </div>















  <!-- //===== ============JavaScript==================================== -->
<script>
  async function loadAdminData() {
    try {
      const res = await fetch("/admin/data", { credentials: "include" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      //================ --- Skills ---
      document.getElementById("skillsList").innerHTML =
        data.skills.map(s => `
          <div class="item">
            <input id="skill_${s.id}" value="${s.name}" />
            <button class="save" onclick="updateItem('skills', ${s.id})">ğŸ’¾ Save</button>
            <button class="delete" onclick="deleteItem('skills', ${s.id})">ğŸ—‘ Delete</button>
          </div>
        `).join('') || "<p>No skills yet.</p>";

      //============== --- Experience ---
      document.getElementById("expList").innerHTML =
        data.experiences.map(e => `
          <div class="item">
            <input id="exp_title_${e.id}" value="${e.title}" placeholder="Title" />
            <input id="exp_company_${e.id}" value="${e.company}" placeholder="Company" />
            <input id="exp_start_${e.id}" value="${e.start_date || ''}" placeholder="Start Date" />
            <input id="exp_end_${e.id}" value="${e.end_date || ''}" placeholder="End Date" />
            <textarea id="exp_desc_${e.id}" placeholder="Description">${e.description || ''}</textarea>
            <button class="save" onclick="updateItem('experience', ${e.id})">ğŸ’¾ Save</button>
            <button class="delete" onclick="deleteItem('experience', ${e.id})">ğŸ—‘ Delete</button>
          </div>
        `).join('') || "<p>No experiences yet.</p>";


      // ==================--- Projects ---
      document.getElementById("projList").innerHTML =
        data.projects.map(p => `
          <div class="item">
            <input id="proj_title_${p.id}" value="${p.title}" placeholder="Title" />
            <textarea id="proj_desc_${p.id}" placeholder="Description">${p.description || ''}</textarea>
            <button class="save" onclick="updateItem('projects', ${p.id})">ğŸ’¾ Save</button>
            <button class="delete" onclick="deleteItem('projects', ${p.id})">ğŸ—‘ Delete</button>
          </div>
        `).join('') || "<p>No projects yet.</p>";

      // --- Certificates ---
      document.getElementById("certList").innerHTML =
        data.certificates.map(c => `
          <div class="item">
            <strong>${c.title}</strong> - ${c.name_school}<br>
            ${c.type_of_certificate} (${c.end_date})<br>
            <a href="${c.certificate_link}" target="_blank">View Certificate</a><br>
            <button class="delete" onclick="deleteItem('certificates', ${c.id})">ğŸ—‘ Delete</button>
          </div>
        `).join('') || "<p>No certificates yet.</p>";

    } catch (err) {
      console.error("âŒ Error loading admin data:", err);
      alert("âŒ Failed to load admin data. Check console & make sure you're logged in as admin.");
    }
  }


  // âœ…===================== Update (Save)
  async function updateItem(table, id) {
    let payload = {};
    if (table === "skills") {
      payload.name = document.getElementById(`skill_${id}`).value.trim();
    } else if (table === "experience") {
      payload.title = document.getElementById(`exp_title_${id}`).value.trim();
      payload.company = document.getElementById(`exp_company_${id}`).value.trim();
      payload.start_date = document.getElementById(`exp_start_${id}`).value.trim();
      payload.end_date = document.getElementById(`exp_end_${id}`).value.trim();
      payload.description = document.getElementById(`exp_desc_${id}`).value.trim();
    } else if (table === "projects") {
      payload.title = document.getElementById(`proj_title_${id}`).value.trim();
      payload.description = document.getElementById(`proj_desc_${id}`).value.trim();
    }

    const res = await fetch(`/admin/${table}/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify(payload),
    });

    const result = await res.json();
    alert(result.message || "âœ… Updated successfully");
    loadAdminData();
  }

  // âœ… ================Delete
  async function deleteItem(table, id) {
    if (!confirm("Are you sure you want to delete this item?")) return;
    const res = await fetch(`/admin/${table}/${id}`, {
      method: "DELETE",
      credentials: "include",
    });
    const result = await res.json();
    if (result.success) {
      alert("âœ… Deleted successfully");
      loadAdminData();
    } else {
      alert("âŒ " + (result.error || "Failed to delete"));
    }
  }

  window.onload = loadAdminData;


// ============ HERO IMAGE UPLOAD ============
  document.getElementById('heroForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
      const formData = new FormData(e.target);

        const res = await fetch(`/admin/upload-hero`, {
          method: 'POST',
          body: formData,
          credentials: 'include'
        });

      const data = await res.json();
      alert(data.message || 'âœ… Hero image updated');
    } catch (err) {
      console.error('âŒ Hero upload failed:', err);
      alert('âŒ Failed to upload hero image');
    }
  });

  // Load everything on page load
  window.addEventListener('DOMContentLoaded', loadAdminData);


// <!-- ==================== CLIENT RATINGS SECTION ==================== -->




// âœ… Load ratings from backend
async function loadRatings() {
  try {
    const res = await fetch("/admin/ratings", { credentials: "include" });
    if (!res.ok) throw new Error("Failed to fetch ratings");
    const data = await res.json();

    const list = document.getElementById("ratingList");
    if (!data.data || data.data.length === 0) {
      list.innerHTML = "<p>No ratings yet.</p>";
      return;
    }

    list.innerHTML = data.data.map(r => `
      <div class="item">
        <strong>${r.name}</strong> â­ ${r.rating}/5<br>
        <em>${r.reference || "No reference provided"}</em><br>
        <small>${new Date(r.created_at).toLocaleString()}</small><br>
        <button class="delete" onclick="deleteRating(${r.id})">ğŸ—‘ Delete</button>
      </div>
    `).join("");
  } catch (err) {
    console.error("âŒ Error loading ratings:", err);
    alert("âŒ Failed to load ratings.");
  }
}

// âœ… Delete a rating
async function deleteRating(id) {
  if (!confirm("Are you sure you want to delete this rating?")) return;
  try {
    const res = await fetch(`/admin/ratings/${id}`, {
      method: "DELETE",
      credentials: "include"
    });
    const result = await res.json();
    if (result.success) {
      alert("âœ… Rating deleted successfully!");
      loadRatings();
    } else {
      alert("âŒ " + (result.error || "Failed to delete rating"));
    }
  } catch (err) {
    console.error("âŒ Delete failed:", err);
    alert("âŒ Failed to delete rating");
  }
}

// âœ… Run on page load
window.addEventListener("DOMContentLoaded", loadRatings);


//========= contact.html js admin delete contact send by mail ======// admini.js

document.addEventListener("DOMContentLoaded", async () => {
  const tableBody = document.getElementById("contactTableBody");

  // ğŸ“¨ Load all contacts
  async function loadContacts() {
    try {
      const res = await fetch("/admin/contacts");
      const data = await res.json();

      tableBody.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='4'>No contact messages found.</td></tr>";
        return;
      }

      data.forEach((msg) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${msg.name}</td>
          <td>${msg.email}</td>
          <td>${msg.message}</td>
          <td><button class="deleteBtn" data-id="${msg.id}">ğŸ—‘ï¸ Delete</button></td>
        `;
        tableBody.appendChild(row);
      });
    } catch (err) {
      console.error("âŒ Error loading contacts:", err);
      tableBody.innerHTML = "<tr><td colspan='4'>Error loading messages.</td></tr>";
    }
  }

  // ğŸ—‘ï¸ Delete a contact
  tableBody.addEventListener("click", async (e) => {
    if (e.target.classList.contains("deleteBtn")) {
      const id = e.target.dataset.id;

      if (!confirm("Are you sure you want to delete this message?")) return;

      try {
        const res = await fetch(`/admin/contacts/${id}`, { method: "DELETE" });
        const data = await res.json();

        if (res.ok && data.success) {
          alert("âœ… Message deleted successfully!");
          loadContacts();
        } else {
          alert("âŒ Error deleting message: " + (data.error || "Unknown error"));
        }
      } catch (err) {
        console.error("âŒ Network error deleting message:", err);
        alert("âŒ Network error deleting message.");
      }
    }
  });

  // Load on page start
  loadContacts();
});


// ==================== CORE SKILLS MANAGEMENT ==================== 

async function loadCoreSkills() {
    const container = document.getElementById("skillsList");
    const res = await fetch("/api/core_skills");
    const skills = await res.json();

    if (!skills.length) {
        container.innerHTML = "No skills found.";
        return;
    }

    // container.innerHTML = skills.map(skill => `
    //     <div class="skill-item" data-id="${skill.id}">
    //         <span>${skill.name} (${skill.level})</span>
    //         <button class="delete">Delete</button>
    //     </div>
    // `).join("");
}

// Event delegation for delete================
// document.getElementById("skillsList").addEventListener("click", async (e) => {
//     if (!e.target.classList.contains("delete")) return;

//     const div = e.target.closest(".skill-item");
//     const id = div.dataset.id;

//     if (!confirm("Are you sure you want to delete this skill?")) return;

//     try {
//         const res = await fetch(`/api/core_skills/${id}`, { method: "DELETE" });
//         if (!res.ok) throw new Error("Delete failed");
//         loadCoreSkills(); // refresh list after deletion
//     } catch (err) {
//         alert(err.message);
//     }
// });

// Add new skill
document.getElementById("addSkillBtn").addEventListener("click", async () => {
    const name = document.getElementById("newName").value.trim();
    const level = document.getElementById("newLevel").value.trim();
    if (!name) return alert("Please enter a category name.");

    try {
        const res = await fetch("/api/core_skills", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, level })
        });
        if (!res.ok) throw new Error("Failed to add skill");
        document.getElementById("newName").value = "";
        document.getElementById("newLevel").value = "";
        loadCoreSkills();
    } catch (err) {
        alert(err.message);
    }
});

// Initial load
loadCoreSkills();  

</script>



</body>
</html>
